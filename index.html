<?php
require 'db.php';

function resetAutoIncrement($pdo) {
    // Fetch all users ordered by ID
    $stmt = $pdo->query("SELECT * FROM users ORDER BY id ASC");
    $users = $stmt->fetchAll(PDO::FETCH_ASSOC);

    // Temporarily disable foreign key checks (optional if you have no FKs)
    $pdo->exec("SET FOREIGN_KEY_CHECKS=0");

    // Truncate the table and re-insert users with new IDs
    $pdo->exec("TRUNCATE TABLE users");

    $stmt = $pdo->prepare("INSERT INTO users (name, email, course) VALUES (?, ?, ?)");
    foreach ($users as $user) {
        $stmt->execute([$user['name'], $user['email'], $user['course']]);
    }

    // Re-enable foreign key checks
    $pdo->exec("SET FOREIGN_KEY_CHECKS=1");
}

if (isset($_POST['create'])) {
    $name   = $_POST['name'];
    $email  = $_POST['email'];
    $course = $_POST['course'];

    $stmt = $pdo->prepare("INSERT INTO users (name, email, course) VALUES (?, ?, ?)");
    $stmt->execute([$name, $email, $course]);

    resetAutoIncrement($pdo);
    header("Location: index.php");
    exit;
}

if (isset($_POST['update'])) {
    $id     = $_POST['id'];
    $name   = $_POST['name'];
    $email  = $_POST['email'];
    $course = $_POST['course'];

    $stmt = $pdo->prepare("UPDATE users SET name = ?, email = ?, course = ? WHERE id = ?");
    $stmt->execute([$name, $email, $course, $id]);

    header("Location: index.php");
    exit;
}

if (isset($_GET['delete'])) {
    $id = $_GET['delete'];

    $stmt = $pdo->prepare("DELETE FROM users WHERE id = ?");
    $stmt->execute([$id]);

    resetAutoIncrement($pdo);
    header("Location: index.php");
    exit;
}

$stmt  = $pdo->query("SELECT * FROM users ORDER BY id ASC");
$users = $stmt->fetchAll(PDO::FETCH_ASSOC);

/* ------------------------------------------
   ‚úèÔ∏è FETCH USER FOR EDITING
------------------------------------------ */
$editUser = null;
if (isset($_GET['edit'])) {
    $id = $_GET['edit'];
    $stmt = $pdo->prepare("SELECT * FROM users WHERE id = ?");
    $stmt->execute([$id]);
    $editUser = $stmt->fetch(PDO::FETCH_ASSOC);
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üê±</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
/* üåà Animated Background */
body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e);
    background-size: 800% 800%;
    animation: gradientShift 7s ease infinite;
    color: #fff;
    overflow: hidden;
}
@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* ‚ú® Glowing Container */
.container {
    position: relative;
    width: 500px;
    padding: 40px;
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(20px);
    box-shadow: 0 0 40px rgba(255, 118, 188, 0.5),
                0 0 80px rgba(161, 140, 209, 0.4);
    z-index: 2;
    overflow: hidden;
}
.container::before {
    content: "";
    position: absolute;
    inset: -4px;
    z-index: -1;
    border-radius: 22px;
    background: linear-gradient(#ffa69e, #f9f871, #45cb85, #57e2e5, #fbc2eb, #a18cd1, #ff7eb3, #ff758c, 270deg);
    background-size: 400% 400%;
    animation: borderFlow 7s linear infinite;
    filter: blur(20px);
}
@keyframes borderFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* üéì Logo */
.logo-floating {
    font-size: 90px;
    text-align: center;
    margin-bottom: 15px;
    font-weight: bold;
    background: linear-gradient(270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e);
    background-size: 400% 400%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: floatLogo 3s ease-in-out infinite, gradientLogo 7s linear infinite;
    text-shadow: 0 0 25px rgba(255, 118, 188, 0.7);
}
@keyframes floatLogo {
    0%,100% { transform: translateY(0px); }
    50% { transform: translateY(-15px); }
}
@keyframes gradientLogo {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

h1 {
  margin-top: 10px;
  margin-bottom: 30px;
  font-size: 2em;
  font-weight: 800;
  text-align: center;

  /* Rainbow Gradient Background */
  background: linear-gradient(
    270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e
  );
  background-size: 300% 300%;
  background-clip: text;
  -webkit-background-clip: text;
  color: transparent;
  -webkit-text-fill-color: transparent;

  animation: rainbowTextGlow 7s ease infinite;

  /* Optional Glow */
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.5),
               0 0 20px rgba(255, 255, 255, 0.3);
}

@keyframes rainbowTextGlow {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

h1::after {
  content: "";
  position: relative;
  width: 80%;
  height: 20px;
  bottom: -15px;
  left: 10%;
  background: linear-gradient(270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e 0%);

  z-index: -1;
}

@keyframes rainbowText {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

form {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 25px;
}
input[type="text"],
input[type="email"] {
    padding: 14px;
    border-radius: 10px;
    border: none;
    outline: none;
    font-size: 15px;
    color: #fff;
    background: rgba(255, 255, 255, 0.15);
    box-shadow: 0 0 10px rgba(255, 118, 188, 0.6);
    transition: transform 0.2s, box-shadow 0.3s;
}
input:focus, input:hover {
    box-shadow: 0 0 20px rgba(255, 118, 188, 0.9);
    transform: scale(1.03);
}
button {
    padding: 14px;
    border: none;
    border-radius: 10px;
    font-weight: 700;
    font-size: 16px;
    color: #fff;
    cursor: pointer;
    background: linear-gradient(270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e);
    background-size: 300% 300%;
    animation: gradientMove 7s ease infinite;
    box-shadow: 0 0 15px rgba(255, 118, 188, 0.7);
    transition: transform 0.3s;
}
button:hover { transform: scale(1.08); }
@keyframes gradientMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }

/* üåü Modern Glowing Table */
.student-table {
  width: 100%;
  margin-top: 30px;
  border-collapse: collapse;
  text-align: center;
  overflow: hidden;
  border-radius: 16px;
  backdrop-filter: blur(15px);
  box-shadow: 0 0 20px rgba(255, 0, 140, 0.3);
}

/* ‚ú® Header Glowing Gradient */
.student-table thead {
  background: linear-gradient(270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e);
  animation: gradientMove 7s ease infinite;
  background-size: 300% 300%;
}

.student-table th {
  padding: 16px;
  font-size: 1rem;
  font-weight: 700;
  text-transform: uppercase;
  color: #fff;
  letter-spacing: 1px;
  border: 2px solid transparent;
  border-image: linear-gradient(270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e) 1;
  box-shadow: 0 0 20px rgba(255, 0, 255, 0.4),
              0 0 40px rgba(0, 255, 255, 0.3),
              inset 0 0 10px rgba(255, 255, 255, 0.1);
  position: relative;
}

/* ‚ú® Glow under text */
.student-table th::after {
  content: "";
  position: absolute;
  bottom: 5px;
  left: 50%;
  transform: translateX(-50%);
  width: 60%;
  height: 3px;
  background: linear-gradient(270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e);
  box-shadow: 0 0 12px rgba(255, 0, 255, 0.8);
  border-radius: 50px;
}

/* üìä Table Cells */
.student-table td {
  padding: 4px;
  color: #fff;
  font-size: 0rem;
  background: rgba(255, 255, 255, 0.15);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  transition: background 0.3s ease;
}

.student-table tr:hover td {
  background: rgba(255, 255, 255, 0.15);
}

/* üåà Animated gradient movement */
@keyframes gradientMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* ‚ú® Shared Button Style */
a.edit, 
a.delete {
  display: inline-block;
  padding: 10px 20px;
  margin: 4px;
  font-size: 16px;
  font-weight: 600;
  color: #fff;
  text-decoration: none;
  border-radius: 50px;
  position: relative;
  overflow: hidden;
  transition: all 0.4s ease;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  cursor: pointer;
  z-index: 1;
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid transparent;
  backdrop-filter: blur(6px);
}

/* üåà Gradient Border Magic */
a.edit::before,
a.delete::before {
  content: "";
  position: absolute;
  inset: 0;
  padding: 2px;
  border-radius: 50px;
  background: linear-gradient(270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e);
  background-size: 300% 300%;
  animation: gradientMove 6s linear infinite;
  -webkit-mask: 
    linear-gradient(#fff 0 0) content-box, 
    linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  z-index: -1;
}

/* ‚úèÔ∏è Edit Button Colors */
a.edit {
  background: rgba(0, 114, 255, 0.15);
  box-shadow: 0 0 15px rgba(0, 198, 255, 0.5);
}

/* üóëÔ∏è Delete Button Colors */
a.delete {
  background: rgba(255, 75, 31, 0.15);
  box-shadow: 0 0 15px rgba(255, 75, 31, 0.5);
}

/* ‚ú® Hover Effects */
a.edit:hover, 
a.delete:hover {
  transform: scale(1.07);
  letter-spacing: 1px;
  box-shadow: 0 0 25px rgba(255, 255, 255, 0.7);
  background: rgba(255, 255, 255, 0.1);
}

/* üåà Gradient Animation */
@keyframes gradientMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.glow-table {
  box-shadow: 0 0 30px rgba(255, 118, 188, 0.8), 0 0 50px rgba(120, 115, 245, 0.5);
}

/* üåü Glowing Gradient Row */
.glow-row td::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 12px;
  padding: 2px;
  background: linear-gradient(
    270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e
  );
  background-size: 800% 800%;
  animation: rainbowGlow 7s ease infinite;
  -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.4s ease;
}

.glow-row:hover td::before {
  opacity: 1;
}

@keyframes rainbowGlow {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

.glow-row:hover td::before {
  opacity: 1;
}

/* üí´ Glow Animation on Hover */
.glow-row td::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 12px;
  padding: 2px;
  background: linear-gradient(
    270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e
  );
  background-size: 800% 800%;
  animation: rainbowGlow 7s ease infinite;
  -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.4s ease;
}

.glow-row:hover td::before {
  opacity: 1;
}

@keyframes rainbowGlow {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

.glow-row:hover td::before {
  opacity: 1;
}

/*  Add a floating neon border */
.glow-row td::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 12px;
  padding: 2px;
  background: linear-gradient(
    270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e
  );
  background-size: 800% 800%;
  animation: rainbowGlow 7s ease infinite;
  -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.4s ease;
}

.glow-row:hover td::before {
  opacity: 1;
}

@keyframes rainbowGlow {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

.glow-row:hover td::before {
  opacity: 1;
}

@keyframes borderFlow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
</style>

<style>
    /* üåü Common button styles */
a.edit,
a.delete {
  display: inline-block;
  padding: 8px 18px;
  margin: 4px;
  font-size: 0.95rem;
  font-weight: 600;
  text-decoration: none;
  color: #fff;
  border: 2px solid transparent;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  transition: 0.3s ease;
  position: relative;
  z-index: 1;
}

/* ‚ú® Gradient border animation */
a.edit::before,
a.delete::before {
  content: "";
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  z-index: -1;
  border-radius: 14px;
  background: linear-gradient(270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e);
  background-size: 200% 200%;
  animation: borderGlow 7s linear infinite;
  opacity: 0.8;
}

/* üü¢ Edit button specific */
a.edit {
  border-color: #00f0ff;
  box-shadow: 0 0 15px rgba(0, 240, 255, 0.5);
}

/* üî• Delete button specific */
a.delete {
  border-color: #ff0066;
  box-shadow: 0 0 15px rgba(255, 0, 102, 0.5);
}

/* ‚ú® Hover effects */
a.edit:hover,
a.delete:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 25px rgba(255, 255, 255, 0.8);
  background: rgba(255, 255, 255, 0.08);
}

/* üåà Animated glowing border */
@keyframes borderGlow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
</style>

<style>
  .student-table {
  position: relative;
  width: 100%;
  border-collapse: collapse;
  margin-top: 30px;
  overflow: hidden;
  border-radius: 16px;
  z-index: 1;
  color: #fff;
  box-shadow: 0 0 40px rgba(255, 118, 188, 0.5),
              0 0 80px rgba(161, 140, 209, 0.4);
  background: linear-gradient(270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e);
  background-size: 800% 800%;
  animation: tableGlowShift 7s ease infinite;
}

@keyframes tableGlowShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.student-table td,
.student-table th {
  background-color: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(4px);
}

</style>

<style>

    .table-cell {
    padding: 10px;
    width: 150px;       /* Set a fixed width */
    max-width: 200px;   /* Optional: prevent it from growing too wide */
    white-space: nowrap; /* Optional: prevent wrapping */
    overflow: hidden;   /* Hide overflowed content */
    text-overflow: ellipsis; /* Add "..." if content is too long */
}
<td class="table-cell" style="width: 100px;"><?= htmlspecialchars($user['id']) ?></td>
<td class="table-cell" style="width: 200px;"><?= htmlspecialchars($user['name']) ?></td>
<td class="table-cell" style="width: 250px;"><?= htmlspecialchars($user['email']) ?></td>
<td class="table-cell" style="width: 150px;"><?= htmlspecialchars($user['course']) ?></td>

</style>

<style>

  .table-scroll {
  overflow-x: auto;
  max-width: 100%;
  margin-top: 30px;
  padding: 10px;
  border-radius: 16px;
  backdrop-filter: blur(15px);
  background: rgba(255, 255, 255, 0.1);
  box-shadow: 0 0 25px rgba(255, 118, 188, 0.4),
              0 0 50px rgba(161, 140, 209, 0.3);
  position: relative;
}

/* Glowing gradient border around scroll container */
.table-scroll::before {
  content: "";
  position: absolute;
  inset: -2px;
  z-index: -1;
  border-radius: 18px;
  background: linear-gradient(270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e);
  background-size: 800% 800%;
  animation: scrollGlow 7s ease infinite;
  filter: blur(8px);
}

/* Scrollbar glow (Webkit only) */
.table-scroll::-webkit-scrollbar {
  height: 12px;
}

.table-scroll::-webkit-scrollbar-track {
  background: transparent;
  border-radius: 10px;
}

.table-scroll::-webkit-scrollbar-thumb {
  border-radius: 10px;
  background: linear-gradient(270deg,
    #ff758c,
    #ff7eb3,
    #a18cd1,
    #fbc2eb,
    #57e2e5,
    #45cb85,
    #f9f871,
    #ffa69e);
  background-size: 400% 400%;
  animation: scrollGlow 7s ease infinite;
  box-shadow: 0 0 10px rgba(255, 118, 188, 0.6);
}

/* Optional: For Firefox */
.table-scroll {
  scrollbar-color: #ff7eb3 #2c2c2c;
  scrollbar-width: thin;
}

@keyframes scrollGlow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.table-scroll:hover {
  box-shadow: 0 0 30px rgba(255, 118, 188, 0.6),
              0 0 60px rgba(161, 140, 209, 0.4);
}

</style>

</head>
<body>
<div class="container">
    <div class="logo-floating">üéì</div>
    <h1>Student Management</h1>

    <!-- üìù Add / Update Form -->
    <form method="POST">
        <input type="hidden" name="id" value="<?= htmlspecialchars($editUser['id'] ?? '') ?>">

        <input type="text" name="name" placeholder="Name" value="<?= htmlspecialchars($editUser['name'] ?? '') ?>" required>

        <input type="email" name="email" placeholder="Email Address" value="<?= htmlspecialchars($editUser['email'] ?? '') ?>" required>

        <input type="text" name="course" placeholder="Course" value="<?= htmlspecialchars($editUser['course'] ?? '') ?>" required>

        <button type="submit" name="<?= $editUser ? 'update' : 'create' ?>">
            <?= $editUser ? 'Update User' : 'Add User' ?>

        </button>

        <?php if ($editUser): ?>
            <a href="index.php" style="text-align:center; margin-top:10px; display:block; color:#fff;">Cancel</a>
        <?php endif; ?>
    </form>

  <div class="table-scroll">
    <table class="student-table">
      <thead>
        <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Course</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <?php foreach ($users as $user): ?>
<tr class="glow-row">
    <td class="table-cell"><?= htmlspecialchars($user['id']) ?></td>
    <td class="table-cell"><?= htmlspecialchars($user['name']) ?></td>
    <td class="table-cell"><?= htmlspecialchars($user['email']) ?></td>
    <td class="table-cell"><?= htmlspecialchars($user['course']) ?></td>
    <td class="table-cell">
        <a class="edit" href="?edit=<?= htmlspecialchars($user['id']) ?>">Edit</a>
        <a class="delete" href="?delete=<?= htmlspecialchars($user['id']) ?>" onclick="return confirm('Are you sure you want to delete this user?')">Delete</a>
          </td>
      </tr>
      <?php endforeach; ?>
      </tbody>
    </table>
  </div>
</body>
</html>